(function(e){function t(t){for(var a,n,i=t[0],l=t[1],c=t[2],d=0,h=[];d<i.length;d++)n=i[d],Object.prototype.hasOwnProperty.call(r,n)&&r[n]&&h.push(r[n][0]),r[n]=0;for(a in l)Object.prototype.hasOwnProperty.call(l,a)&&(e[a]=l[a]);u&&u(t);while(h.length)h.shift()();return o.push.apply(o,c||[]),s()}function s(){for(var e,t=0;t<o.length;t++){for(var s=o[t],a=!0,i=1;i<s.length;i++){var l=s[i];0!==r[l]&&(a=!1)}a&&(o.splice(t--,1),e=n(n.s=s[0]))}return e}var a={},r={app:0},o=[];function n(t){if(a[t])return a[t].exports;var s=a[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=e,n.c=a,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(s,a,function(t){return e[t]}.bind(null,a));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],l=i.push.bind(i);i.push=t,i=i.slice();for(var c=0;c<i.length;c++)t(i[c]);var u=l;o.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"034f":function(e,t,s){"use strict";var a=s("85ec"),r=s.n(a);r.a},"56d7":function(e,t,s){"use strict";s.r(t);s("e260"),s("e6cf"),s("cca6"),s("a79d"),s("ab8b");var a=s("2b0e"),r=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"container",attrs:{id:"app"}},[s("TheLogin"),s("SelectUser"),s("DailyFood")],1)},o=[],n=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"row justify-content-center"},[e._m(0),s("div",{staticClass:"row"},[e.authenticated?s("h4",{staticClass:"border-top border-bottom p-1"},[e._v("Logged in as "+e._s(e.apiUsername))]):s("form",{attrs:{method:"post"},on:{submit:e.logIn}},[s("h3",[e._v("Log in")]),e.errors.length?s("p",[s("b",[e._v("Please correct the following error(s):")]),s("ul",e._l(e.errors,(function(t){return s("li",{key:t},[e._v(e._s(t))])})),0)]):e._e(),e.loginErrors.length?s("p",[s("b",[e._v("Please correct the following error(s):")]),s("ul",e._l(e.loginErrors,(function(t){return s("li",{key:t},[e._v(e._s(t))])})),0)]):e._e(),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.usernameInput,expression:"usernameInput"}],staticClass:"form-control",attrs:{type:"text",name:"username",placeholder:"Username"},domProps:{value:e.usernameInput},on:{input:function(t){t.target.composing||(e.usernameInput=t.target.value)}}})]),s("div",{staticClass:"form-group"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.password,expression:"password"}],staticClass:"form-control",attrs:{type:"password",name:"password",placeholder:"Password"},domProps:{value:e.password},on:{input:function(t){t.target.composing||(e.password=t.target.value)}}})]),s("button",{staticClass:"btn btn-dark btn-block",attrs:{type:"submit"}},[e._v("Log in")])])])])},i=[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"col-12"},[s("h1",[e._v("Calorie counter")])])}],l=s("5530"),c=s("2f62"),u={name:"TheLogin",data:function(){return{errors:[],usernameInput:null,password:null}},methods:{logIn:function(e){this.errors=[],this.usernameInput||this.errors.push("Username required."),this.password||this.errors.push("Password required."),0==this.errors.length&&(this.$store.dispatch("onLoginStarted",{apiUsername:this.usernameInput,apiAuthString:btoa(this.usernameInput+":"+this.password)}),this.$store.dispatch("refreshToken")),e.preventDefault()}},computed:Object(l["a"])({},Object(c["b"])(["token","authenticated","apiUsername","apiAuthString","loginErrors"]))},d=u,h=s("2877"),m=Object(h["a"])(d,n,i,!1,null,"62b3ba57",null),f=m.exports,p=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.authenticated?s("div",{staticClass:"row justify-content-center p-3"},[e.newUserFormVisible?s("div",{staticClass:"col-md-6"},[e.authenticated?s("form",{attrs:{method:"post"},on:{submit:e.addUser}},[s("h3",[e._v("Add new user")]),e.errors.length?s("p",{staticClass:"alert alert-danger row"},[s("b",[e._v("Please correct the following error(s):")]),s("ul",e._l(e.errors,(function(t){return s("li",{key:t},[e._v(e._s(t))])})),0)]):e._e(),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Name")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.username,expression:"username"}],staticClass:"form-control col-sm-8",attrs:{type:"text",name:"username",placeholder:"Matti"},domProps:{value:e.username},on:{input:function(t){t.target.composing||(e.username=t.target.value)}}})]),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Age")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.age,expression:"age"}],staticClass:"form-control col-sm-8",attrs:{type:"number",min:"0",name:"age",placeholder:"22"},domProps:{value:e.age},on:{input:function(t){t.target.composing||(e.age=t.target.value)}}})]),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Height")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.height,expression:"height"}],staticClass:"form-control col-sm-8",attrs:{type:"number",name:"height",placeholder:"170"},domProps:{value:e.height},on:{input:function(t){t.target.composing||(e.height=t.target.value)}}})]),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Weight")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.weight,expression:"weight"}],staticClass:"form-control col-sm-8",attrs:{type:"number",name:"weight",placeholder:"70"},domProps:{value:e.weight},on:{input:function(t){t.target.composing||(e.weight=t.target.value)}}})]),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Exercise level")]),s("select",{directives:[{name:"model",rawName:"v-model",value:e.exerciseLevel,expression:"exerciseLevel"}],staticClass:"form-control col-sm-8",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.exerciseLevel=t.target.multiple?s:s[0]}}},[s("option",{attrs:{value:"Low"}},[e._v("Low")]),s("option",{attrs:{value:"Normal"}},[e._v("Normal")]),s("option",{attrs:{value:"High"}},[e._v("High")])])]),s("button",{staticClass:"btn btn-dark mr-3",attrs:{type:"submit"}},[e._v("Add user")]),s("button",{staticClass:"btn btn-secondary",attrs:{type:"button"},on:{click:e.hideNewUserForm}},[e._v("Cancel")])]):e._e()]):s("div",[s("button",{staticClass:"btn btn-dark btn-block p-6",on:{click:e.showNewUserForm}},[e._v("Add new user")]),s("p",{staticClass:"mt-2 mb-0"},[e._v("OR")]),s("p",{staticClass:"mb-1"},[e._v("Select user")]),s("div",{staticClass:"row justify-content-center"},[s("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedUserRecId,expression:"selectedUserRecId"}],staticClass:"col-sm-8",on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedUserRecId=t.target.multiple?s:s[0]}}},[s("option",{attrs:{disabled:"",value:""}},[e._v("Select user")]),e._l(e.filteredUsers,(function(t){return s("option",{key:t.recordId,domProps:{value:t.recordId}},[e._v(" "+e._s(t.fieldData.name)+" ")])}))],2)]),null!=e.userData?s("h4",{staticClass:"pt-3"},[e._v("Selected user "+e._s(e.userData.fieldData.name))]):s("h4",{staticClass:"pt-3"},[e._v("No user selected")])])]):e._e()},v=[],g=(s("4de4"),s("b0c0"),s("d3b7"),{name:"SelectUser",data:function(){return{errors:[],username:null,age:null,height:null,weight:null,exerciseLevel:"Normal",selectedUserRecId:null,fetchingUsers:!1,allUsers:null}},methods:{showNewUserForm:function(){this.$store.dispatch("changeNewUserFormVisibility",!0)},hideNewUserForm:function(){this.$store.dispatch("changeNewUserFormVisibility",!1)},addUser:function(e){var t=this;this.errors=[],this.username||this.errors.push("Username required."),this.age||this.errors.push("Age required."),this.height||this.errors.push("Height required."),this.weight||this.errors.push("Weight required."),this.exerciseLevel||this.errors.push("Exercise level required."),this.errors.length||fetch("https://testaus.dyndns.org/fmi/data/v1/databases/Calories/layouts/User/records",{method:"POST",headers:{Authorization:"Bearer "+this.token,"Content-type":"application/json"},body:JSON.stringify({fieldData:{age:this.age,Height:this.height,Weight:this.weight,Exercise_level:this.exerciseLevel,name:this.username}})}).then((function(e){if(e.ok)return e.json();401==e.status&&t.$store.dispatch("refreshToken")})).then((function(e){t.fetchAllUsers(),t.selectedUserRecId=e.response.recordId,t.hideNewUserForm()})).catch((function(e){console.log(e)})),e.preventDefault()},fetchAllUsers:function(){var e=this;this.fetchingUsers=!0,fetch("https://testaus.dyndns.org/fmi/data/v1/databases/Calories/layouts/User/records",{method:"GET",headers:{Authorization:"Bearer "+this.token}}).then((function(t){if(t.ok)return t.json();401==t.status&&e.$store.dispatch("refreshToken")})).then((function(t){e.allUsers=t.response.data,e.fetchingUsers=!1})).catch((function(e){console.log(e)}))},handleUserSelection:function(){for(var e=0;e<this.allUsers.length;e++)if(this.allUsers[e].recordId==this.selectedUserRecId){this.selectedUserName=this.allUsers[e].fieldData.name,this.$store.dispatch("userSelected",this.allUsers[e]);break}}},computed:Object(l["a"])(Object(l["a"])({},Object(c["b"])(["token","authenticated","newUserFormVisible","userData"])),{},{filteredUsers:function(){return null!=this.allUsers?this.allUsers.filter((function(e){return""!=e.fieldData.name})):[]}}),created:function(){this.authenticated&&!this.fetchingUsers&&null==this.allUsers&&this.fetchAllUsers()},watch:{authenticated:function(e){e&&this.fetchAllUsers()},selectedUserRecId:function(e){null!=e&&this.handleUserSelection()},allUsers:function(e){e&&this.handleUserSelection()}}}),b=g,y=Object(h["a"])(b,p,v,!1,null,"75a5196d",null),_=y.exports,C=function(){var e=this,t=e.$createElement,s=e._self._c||t;return e.authenticated&&!e.newUserFormVisible&&null!=e.userData?s("div",{staticClass:"row justify-content-center border-top pt-2"},[s("div",{staticClass:"col-md-6"},[s("h4",{staticClass:"col-12"},[e._v("Select food you have eaten")]),s("form",{attrs:{method:"post"},on:{submit:e.addFoodForDate}},[e.errors.length?s("p",{staticClass:"alert alert-danger row"},[s("b",[e._v("Please correct the following error(s):")]),s("ul",e._l(e.errors,(function(t){return s("li",{key:t},[e._v(e._s(t))])})),0)]):e._e(),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Date")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.selectedDate,expression:"selectedDate"}],staticClass:"form-control col-sm-8",attrs:{type:"date",name:"selected-date"},domProps:{value:e.selectedDate},on:{input:function(t){t.target.composing||(e.selectedDate=t.target.value)}}})]),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Food")]),s("select",{directives:[{name:"model",rawName:"v-model",value:e.selectedFoodRecId,expression:"selectedFoodRecId"}],staticClass:"form-control col-sm-8",attrs:{name:"selected-food"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.selectedFoodRecId=t.target.multiple?s:s[0]}}},[s("option",{attrs:{disabled:"",value:""}},[e._v("Select food")]),e._l(e.foodItems,(function(t){return s("option",{key:t.recordId,domProps:{value:t.recordId}},[e._v(" "+e._s(t.fieldData.Food)+" ")])}))],2)]),s("div",{staticClass:"form-group row"},[s("label",{staticClass:"col-form-label col-sm-4"},[e._v("Quantity (grams)")]),s("input",{directives:[{name:"model",rawName:"v-model",value:e.quantity,expression:"quantity"}],staticClass:"form-control col-sm-8",attrs:{type:"number",name:"quantity",placeholder:"125",min:"1"},domProps:{value:e.quantity},on:{input:function(t){t.target.composing||(e.quantity=t.target.value)}}})]),s("div",{staticClass:"form-group row mb-1"},[s("p",{staticClass:"col-form-label col-sm-4"},[e._v("Calories")]),s("span",{staticClass:"col-sm-4 text-left"},[e._v(e._s(e.calcCalories))]),s("button",{staticClass:"btn btn-dark col-sm-4",attrs:{type:"submit"}},[e._v("Submit")])])])]),s("h3",{staticClass:"col-12 mt-2"},[e._v("Selected date summary")]),null!=e.selectedDateSummary?s("div",[s("h4",{staticClass:"col-12"},[e._v("Calories: "+e._s(e.selectedDateSummary.TotalCalories.toFixed(2)))]),s("ul",e._l(e.selectedDateSummary.FoodItems,(function(t){return s("li",{key:t.Date},[s("span",{staticClass:"float-left"},[e._v(e._s(t.Food))]),s("span",{staticClass:"float-right ml-2"},[e._v(e._s(t.Calories.toFixed(2))+" cal")])])})),0)]):s("p",[e._v("No records for the selected date.")]),s("h3",{staticClass:"col-12 border-top pt-1"},[e._v("All dates")]),e.calorieSummaries&&e.calorieSummaries.length>0?s("div",e._l(e.calorieSummaries,(function(t){return s("div",{key:t.Date},[s("h4",{staticClass:"col-12"},[e._v(e._s(t.Date)+": "+e._s(t.TotalCalories.toFixed(2))+" cal")])])})),0):s("p",[e._v("No records.")])]):e._e()},w=[],D=(s("a434"),{name:"DailyFood",data:function(){return{errors:[],selectedFoodRecId:null,quantity:null,selectedDate:null,foodItems:null,selectedFoodData:null,calorieItems:null,calorieSummaries:null,selectedDateSummary:null}},methods:{fetchFoodItems:function(){var e=this;fetch("https://testaus.dyndns.org/fmi/data/v1/databases/Calories/layouts/Food_items/records",{method:"GET",headers:{Authorization:"Bearer "+this.token}}).then((function(t){if(t.ok)return t.json();401==t.status&&e.$store.dispatch("refreshToken")})).then((function(t){t&&(e.foodItems=t.response.data)})).catch((function(e){console.log(e)}))},fetchCalories:function(){var e=this;fetch("https://testaus.dyndns.org/fmi/data/v1/databases/Calories/layouts/Calories/_find",{method:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},body:JSON.stringify({query:[{fk_user:"="+this.userData.fieldData.PrimaryKey},{CreationTimestamp:"",omit:"true"}]})}).then((function(t){if(t.ok)return t.json();401==t.status&&e.$store.dispatch("refreshToken")})).then((function(t){t?e.calorieItems=t.response.data:(e.calorieItems=null,e.calorieSummaries=null,e.selectedDateSummary=null),e.calcCaloriesForAllDates(),e.setupDateSummary()})).catch((function(e){console.log(e)}))},addFoodForDate:function(e){var t=this;this.errors=[],this.selectedDate||this.errors.push("Date required."),this.selectedFoodRecId||this.errors.push("Food required."),this.quantity||this.errors.push("Quantity required."),0==this.errors.length&&fetch("https://testaus.dyndns.org/fmi/data/v1/databases/Calories/layouts/Calories/records",{method:"POST",headers:{Authorization:"Bearer "+this.token,"Content-Type":"application/json"},body:JSON.stringify({fieldData:{fk_user:this.userData.fieldData.PrimaryKey,fk_item:this.selectedFoodData.fieldData.PrimaryKey,Food:this.selectedFoodData.fieldData.Food,Quantity:this.quantity,Calories:this.calcCalories,date:this.date}})}).then((function(e){if(e.ok)return e.json();401==e.status&&t.$refs.TheLogin.refreshToken()})).then(this.fetchCalories()).catch((function(e){console.log(e)})),e.preventDefault()},calcCaloriesForAllDates:function(){var e=[];if(this.calorieItems)for(var t=0;t<this.calorieItems.length;t++){var s=this.calorieItems[t],a=new Date(s.fieldData.CreationTimestamp);a.setHours(0,0,0,0),a=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate();for(var r=!1,o=0;o<e.length;o++){if(e[o].Date==a){e[o].FoodItems.push({Food:s.fieldData.Food,Calories:s.fieldData.Calories}),e[o].TotalCalories+=s.fieldData.Calories,r=!0;break}if(e[o].Date<a){e.splice(o,0,{Date:a,TotalCalories:s.fieldData.Calories,FoodItems:[{Food:s.fieldData.Food,Calories:s.fieldData.Calories}]}),r=!0;break}}r||e.push({Date:a,TotalCalories:s.fieldData.Calories,FoodItems:[{Food:s.fieldData.Food,Calories:s.fieldData.Calories}]})}this.calorieSummaries=e},setupDateSummary:function(){var e=this.calorieSummaries;if(e)for(var t=0;t<e.length;t++)if(e[t].Date==this.selectedDate)return void(this.selectedDateSummary=e[t]);this.selectedDateSummary=null}},computed:Object(l["a"])(Object(l["a"])({},Object(c["b"])(["token","authenticated","newUserFormVisible","userData"])),{},{calcCalories:function(){var e=0;return this.selectedFoodData&&this.quantity&&(e=this.quantity/100*this.selectedFoodData.fieldData.Calories_in_100g),e}}),watch:{userData:function(e){this.authenticated&&null!=e&&(this.selectedDateSummary=null,this.fetchFoodItems(),this.fetchCalories())},selectedFoodRecId:function(e){if(null!=e)for(var t=0;t<this.foodItems.length;t++)if(this.foodItems[t].recordId==e){this.selectedFoodData=this.foodItems[t];break}},selectedDate:function(e){null!=e&&this.setupDateSummary()}},created:function(){this.authenticated&&(this.fetchFoodItems(),this.userData&&(this.fetchCalories(),this.setupDateSummary()))}}),U=D,F=Object(h["a"])(U,C,w,!1,null,"29fa5426",null),k=F.exports,S={name:"App",components:{TheLogin:f,SelectUser:_,DailyFood:k}},I=S,A=(s("034f"),Object(h["a"])(I,r,o,!1,null,null,null)),j=A.exports,x=s("0e44");a["a"].use(c["a"]);var N=new c["a"].Store({plugins:[Object(x["a"])({storage:window.sessionStorage})],state:{apiUsername:null,apiAuthString:null,token:null,authenticated:!1,userData:null,newUserFormVisible:!1,loginErrors:[]},getters:{token:function(e){return e.token},authenticated:function(e){return e.authenticated},newUserFormVisible:function(e){return e.newUserFormVisible},userData:function(e){return e.userData},apiAuthString:function(e){return e.apiAuthString}},mutations:{setLoginData:function(e,t){var s=t.token;e.token=s,e.authenticated=!0},setApiAuthString:function(e,t){e.apiAuthString=t},setApiUsername:function(e,t){e.apiUsername=t},setToken:function(e,t){e.token=t},resetLoginData:function(e){e.token=null,e.authenticated=!1,e.apiUsername=null,e.apiAuthString=null,e.userData=null},setUserData:function(e,t){e.userData=t},setLoginErrors:function(e,t){e.loginErrors=t},setNewUserFormVisible:function(e,t){e.newUserFormVisible=t},addFoodItems:function(e,t){e.foodItems=t}},actions:{onLoginSuccess:function(e,t){var s=e.commit,a=t.token;s("setLoginData",{token:a})},onLoginStarted:function(e,t){var s=e.commit,a=t.apiUsername,r=t.apiAuthString;s("setApiUsername",a),s("setApiAuthString",r)},refreshToken:function(e){var t=e.commit,s=e.getters,a=[];fetch("https://testaus.dyndns.org/fmi/data/v1/databases/Calories/sessions",{method:"POST",headers:{Authorization:"Basic "+s.apiAuthString,"Content-type":"application/json","Content-Length":"0"}}).then((function(e){if(e.ok)return e.json();401==e.status&&a.push("Username or password wrong."),t("resetLoginData"),t("setLoginErrors",a)})).then((function(e){t("setLoginData",{token:e.response.token})})).catch((function(e){console.log(e)}))},tokenRefreshed:function(e,t){var s=e.commit;s("setToken",t)},tokenRefreshFailed:function(e){var t=e.commit;t("resetLoginData")},userSelected:function(e,t){var s=e.commit;s("setUserData",t)},changeNewUserFormVisibility:function(e,t){var s=e.commit;s("setNewUserFormVisible",t)}}}),O=N;a["a"].config.productionTip=!1,new a["a"]({store:O,render:function(e){return e(j)}}).$mount("#app")},"85ec":function(e,t,s){}});
//# sourceMappingURL=app.d24aefd6.js.map